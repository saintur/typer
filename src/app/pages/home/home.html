<div class="main-content">

  <app-header/>
  <main>
    <div class="wrapped-section">
      <section class="first">
        <div>
          <label>‚Ä¢ –•–∏—á—ç—ç–ª</label>
          <h1>10 —Ö—É—Ä—É—É–≥–∞–∞—Ä —Ö—É—Ä–¥–∞–Ω –±–∏—á–∏—Ö —Ö–∏—á—ç—ç–ª</h1>
        </div>

        <div class="b-actions">
          <p-button label="üá≤üá≥ –ú–æ–Ω–≥–æ–ª" severity="contrast" class="{{selectedLanguage === 'MONGOLIAN' ? 'selected-lang' : 'inactive-lang'}}" [rounded]="true" (click)="changeLanguage('MONGOLIAN')"/>
          <p-button label="üá¨üáß English" severity="contrast" class="{{selectedLanguage === 'ENGLISH' ? 'selected-lang' : 'inactive-lang'}}"  [rounded]="true" (click)="changeLanguage('ENGLISH')"/>
        </div>
      </section>
      <div class="drawer">
        <ng-container [ngTemplateOutlet]="drawer"></ng-container>
      </div>
    </div>
    <div class="flex gap-2">
      <section class="one-minute-bg">
        <div>
          <label>‚Ä¢ 1 –ú–∏–Ω—É—Ç</label>
          <div class="flex items-center justify-between gap-2">
            <h2>–ú–∏–Ω—É—Ç—Ç–∞–π —É—Ä–∞–ª–¥–∞—Ö</h2>
            <h1 class="p-2 yellow-back">‚ö°Ô∏è</h1>
          </div>
          <div class="b-actions">
            <p-button routerLink="/typing" [queryParams]="{timer: 'on'}" label="–≠—Ö–ª—ç—Ö" severity="contrast"
                      [rounded]="true"/>
          </div>
        </div>
      </section>

      <section class="one-on-one-bg">
        <div>
          <label>‚Ä¢ 1x1</label>
          <div class="flex items-center justify-between gap-2">
            <h2>–•–æ–æ—Ä–æ–Ω–¥–æ–æ ”©—Ä—Å”©–ª–¥”©—Ö</h2>
            <h1 class="p-2 silver-back">ü•äÔ∏è</h1>
          </div>
          <div class="b-actions">
            <p-button label="“Æ“Ø—Å–≥—ç—Ö" severity="contrast" [rounded]="true"/>
            <p-button label="–•–æ–ª–±–æ–≥–¥–æ—Ö" severity="contrast" [rounded]="true" variant="outlined"/>
          </div>
        </div>
      </section>
    </div>
  </main>
  <footer>
    <code class="small">
      Copyright ¬© 2026
    </code>

    <code class="small">
      –±–∏—á..—á|
    </code>
  </footer>
</div>

<ng-template #drawer>
  <div>
      <p-accordion>
        @for (category of lessons(); track ('category'+category.id)) {
            <p-accordion-panel value="{{ $index }}">
              <p-accordion-header (click)="selectParent(category)">
                <ng-template #toggleicon let-active="active" >
                  @if (active) {
                    <ng-container [ngTemplateOutlet]="lessonProgress" [ngTemplateOutletContext]="{ $implicit: getCateProgress(category.id) }"/><i
                      class="pi pi-minus"></i>
                  } @else {
                    <ng-container [ngTemplateOutlet]="lessonProgress" [ngTemplateOutletContext]="{ $implicit: getCateProgress(category.id) }"/><i
                      class="pi pi-plus"></i>
                  }
                </ng-template>

                <div class="flex items-center gap-2 w-full">
                  <span class="font-bold whitespace-nowrap">{{ category.mnTitle }}</span>
                </div>
              </p-accordion-header>
              <p-accordion-content>
                <ng-container [ngTemplateOutlet]="table" [ngTemplateOutletContext]="{ category: category }"/>
              </p-accordion-content>
            </p-accordion-panel>
          }
      </p-accordion>
  </div>
</ng-template>

<ng-template #lessonProgress let-progress>
  <div class="lesson-progress">
    <p-progressbar [style]="{ height: '8px' }" [value]="progress">
      <ng-template #content let-value>
        <!--                  <span>{{value}}/100</span>-->
      </ng-template>
    </p-progressbar>
  </div>
</ng-template>

<ng-template #table let-category="category">
  <div class="no-bg-table">
    @for(lesson of subLessons(); track ('lesson'+lesson.id)) {
        <div role="row" class="flex items-center gap-2 w-full p-2">
          <div class="flex flex-1 items-center gap-1">@if(lesson.isPremium) { <i class="pi pi-crown text-yellow-500"></i> } {{ lesson.mnTitle }}</div>
          <div>
            @if (lesson.progress != null) {
              <div class="b-actions">
                <p-tag severity="info">{{ speedType }}: {{ getSpeed(lesson.progress) }}</p-tag>

                <small>–û–Ω–æ–≤—á:</small>
                <app-progress
                  [label]="getAccuracy(lesson.progress) + '%'"
                  [value]="getAccuracy(lesson.progress)"
                />

                <small>–Ø–≤—Ü:</small>
                <app-progress
                  [label]="lesson.progress.completionPercent + '%'"
                  [value]="lesson.progress.completionPercent"
                />
              </div>
            }
          </div>
          <div class="last-col">
            <div class="b-actions">
              @if (lesson.progress) {
                @if (lesson.progress.completionPercent === 100) {
                  <p-button variant="outlined" severity="contrast" rounded="true" label="–î–∞—Ö–∏–Ω –ê–≤–∞—Ö" (click)="openRestartDialog(lesson)"/>
                } @else {
                  <p-button severity="primary" rounded="true" label="“Æ—Ä–≥—ç–ª–∂–ª“Ø“Ø–ª—ç—Ö"/>
                }
              }
              @else {
                @if(!lesson.isPremium) {
                  <p-button [routerLink]="['/tutor/'+ selectedLanguage +'/'+category.id +'/'+lesson.id]" variant="outlined" severity="contrast" rounded="true" label="–≠—Ö–ª“Ø“Ø–ª—ç—Ö"/>
                } @else {
                  <p-button [routerLink]="['/tutor/'+ selectedLanguage +'/'+category.id +'/'+lesson.id]" variant="outlined" severity="contrast" rounded="true" label="–£—Ä—å–¥—á–∏–ª—Å–∞–Ω –•–∏—á—ç—ç–ª"/>
                }
              }
            </div>
          </div>
        </div>
    }
  </div>
</ng-template>

<p-dialog
  [(visible)]="showRestartDialog"
  modal="true"
  [closable]="false"
  [dismissableMask]="true"
  [style]="{ width: '380px' }">
  <ng-template #header>
    <div class="flex flex-1 items-center justify-between w-full">
      <span class="font-bold whitespace-nowrap">–•–∏—á—ç—ç–ª–∏–π–≥ –¥–∞—Ö–∏–Ω —ç—Ö–ª“Ø“Ø–ª—ç—Ö</span>

      <a (click)="closeRestartDialog()"><i class="pi pi-times"></i></a>
    </div>
  </ng-template>
  <p>–¢–∞ —Ö–∏—á—ç—ç–ª–∏–π–≥ –¥–∞—Ö–∏–Ω —ç—Ö–ª“Ø“Ø–ª—ç—Ö–∏–π–≥ —Ö“Ø—Å—ç–∂ –±–∞–π–Ω–∞ —É—É?</p>
  <ng-template #footer>
    <div class="flex items-center justify-between w-full">
      <p-button
        label="–¢–∏–π–º"
        severity="danger"
        (onClick)="confirmRestart()">
      </p-button>

      <p-button
        label="“Æ–≥“Ø–π"
        severity="secondary"
        (onClick)="closeRestartDialog()">
      </p-button>
    </div>
  </ng-template>
</p-dialog>
